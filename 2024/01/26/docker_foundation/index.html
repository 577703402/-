<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Docker 基本使用 | 欢迎来到米俊杰的博客</title>
  <meta name="keywords" content=" docker ">
  <meta name="description" content="Docker 基本使用 | 欢迎来到米俊杰的博客">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick">
<meta property="og:type" content="website">
<meta property="og:title" content="Hello World">
<meta property="og:url" content="https://577703402.github.io/mijunjie/hello-world.html">
<meta property="og:site_name" content="欢迎来到米俊杰的博客">
<meta property="og:description" content="Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-01-15T11:44:57.854Z">
<meta property="article:modified_time" content="2024-01-15T06:31:33.707Z">
<meta property="article:author" content="Momo">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/1.png">

<link href="/mijunjie/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/mijunjie/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/mijunjie/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/mijunjie/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.0.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="/mijunjie">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/mijunjie/"
   class="avatar_target">
    <img class="avatar"
         src="/mijunjie/img/1.png"/>
</a>
<div class="author">
    <span>Momo</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://577703402.github.io/mijunjie"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:577703402@qq.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=577703402&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="全部文章">全部文章
            
                <small>(9)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="Linux">
            
            Linux
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Docker">
            
            Docker
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Kubernetes">
            
            Kubernetes
            <small>(6)</small>
        </div>
        
    </li>

            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="9">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>create github</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>docker</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>k8s</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>linux</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="全部文章 Kubernetes "
           href="/mijunjie/2024/03/05/Kubernetes/Create%20kubernetes%20cluster/"
           data-tag="k8s"
           data-author="" >
            <span class="post-title" title="Kubeadm高可用安装Kubernetes cluster">Kubeadm高可用安装Kubernetes cluster</span>
            <span class="post-date" title="2024-03-05 20:57:20">2024/03/05</span>
        </a>
        
        
        <a  class="全部文章 Kubernetes "
           href="/mijunjie/2024/03/04/Kubernetes/%E9%9B%86%E7%BE%A4%E5%8F%AF%E7%94%A8%E6%80%A7%E9%AA%8C%E8%AF%81/"
           data-tag="k8s"
           data-author="" >
            <span class="post-title" title="Kubernetes集群可用性验证">Kubernetes集群可用性验证</span>
            <span class="post-date" title="2024-03-04 23:05:08">2024/03/04</span>
        </a>
        
        
        <a  class="全部文章 Kubernetes "
           href="/mijunjie/2024/02/29/Kubernetes/Kubernetes%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83/"
           data-tag="k8s"
           data-author="" >
            <span class="post-title" title="Kubernetes 命令参考">Kubernetes 命令参考</span>
            <span class="post-date" title="2024-02-29 19:05:12">2024/02/29</span>
        </a>
        
        
        <a  class="全部文章 Kubernetes "
           href="/mijunjie/2024/02/29/Kubernetes/Pod%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/"
           data-tag="k8s"
           data-author="" >
            <span class="post-title" title="Pod">Pod</span>
            <span class="post-date" title="2024-02-29 14:41:51">2024/02/29</span>
        </a>
        
        
        <a  class="全部文章 Kubernetes "
           href="/mijunjie/2024/02/29/Kubernetes/%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/"
           data-tag="k8s"
           data-author="" >
            <span class="post-title" title="K8S 工作节点组件介绍">K8S 工作节点组件介绍</span>
            <span class="post-date" title="2024-02-29 13:53:53">2024/02/29</span>
        </a>
        
        
        <a  class="全部文章 Kubernetes "
           href="/mijunjie/2024/02/29/Kubernetes/%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D/"
           data-tag="k8s"
           data-author="" >
            <span class="post-title" title="K8S 控制节点组件介绍">K8S 控制节点组件介绍</span>
            <span class="post-date" title="2024-02-29 10:23:42">2024/02/29</span>
        </a>
        
        
        <a  class="全部文章 Linux "
           href="/mijunjie/2024/02/21/linux_foundation/"
           data-tag="linux"
           data-author="" >
            <span class="post-title" title="Linux 基本认识">Linux 基本认识</span>
            <span class="post-date" title="2024-02-21 23:07:27">2024/02/21</span>
        </a>
        
        
        <a  class="全部文章 Docker "
           href="/mijunjie/2024/01/26/docker_foundation/"
           data-tag="docker"
           data-author="" >
            <span class="post-title" title="Docker 基本使用">Docker 基本使用</span>
            <span class="post-date" title="2024-01-26 15:48:00">2024/01/26</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/mijunjie/2024/01/19/create_github_io/"
           data-tag="create github"
           data-author="" >
            <span class="post-title" title="Github 测试使用">Github 测试使用</span>
            <span class="post-date" title="2024-01-19 14:08:52">2024/01/19</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-docker_foundation" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Docker 基本使用</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="Docker">Docker</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color2">docker</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2024-02-23 13:34:57'>2024-01-26 15:48</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Docker%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-text">1.1 Docker安装步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Docker%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-text">1.2 Docker基本命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E6%9F%A5%E7%9C%8B-Dcoker-%E7%89%88%E6%9C%AC"><span class="toc-text">1.2.1 查看 Dcoker 版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-%E6%9F%A5%E7%9C%8B-Dcoker-%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-text">1.2.2 查看 Dcoker 详细信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-%E6%90%9C%E7%B4%A2%E9%95%9C%E5%83%8F"><span class="toc-text">1.2.3 搜索镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-%E6%8B%89%E5%8F%96-%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F"><span class="toc-text">1.2.4 拉取&#x2F;下载镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F"><span class="toc-text">1.2.5 查看本地镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-6-%E6%9B%B4%E6%94%B9%E9%95%9C%E5%83%8F-tag"><span class="toc-text">1.2.6 更改镜像 tag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-7-%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E7%99%BB%E9%99%86"><span class="toc-text">1.2.7 镜像仓库登陆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-8-%E6%8E%A8%E9%80%81%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93"><span class="toc-text">1.2.8 推送本地镜像到远程仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-9-%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="toc-text">1.2.9 启动容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-10-%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-text">1.2.10 端口映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-11-%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="toc-text">1.2.11 查看日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-12-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-text">1.2.12 查看容器详细信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-13-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-text">1.2.13 查看当前运行的容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-14-%E5%88%A0%E9%99%A4%E5%B7%B2%E7%BB%8F%E9%80%80%E5%87%BA%E7%9A%84%E5%AE%B9%E5%99%A8%E8%AE%B0%E5%BD%95"><span class="toc-text">1.2.14 删除已经退出的容器记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-15-%E8%BF%9B%E5%85%A5%E5%88%B0%E4%B8%80%E4%B8%AA%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-text">1.2.15 进入到一个后台运行的容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-16-%E5%81%9C%E6%AD%A2-%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="toc-text">1.2.16 停止&#x2F;启动容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-17-%E6%96%87%E4%BB%B6%E6%8B%B7%E8%B4%9D"><span class="toc-text">1.2.17 文件拷贝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-18-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">1.2.18 数据持久化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-DockerFile-%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-text">1.3 DockerFile 的编写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-Dockerfile-%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-text">1.3.1 Dockerfile 的常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="toc-text">1.3.2 构建镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-CMD-%E5%92%8C-ENTRYPOINT-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">1.3.3 CMD 和 ENTRYPOINT 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-4-COPY-%E5%92%8C-ADD-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">1.3.4 COPY 和 ADD 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-5-%E5%AE%9A%E4%B9%89%E4%BD%9C%E8%80%85%E4%BF%A1%E6%81%AF"><span class="toc-text">1.3.5 定义作者信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-6-Dockerfile-%E4%BC%A0%E5%8F%82"><span class="toc-text">1.3.6 Dockerfile 传参</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-7-%E9%95%9C%E5%83%8F%E5%A4%A7%E5%B0%8F%E4%BC%98%E5%8C%96"><span class="toc-text">1.3.7 镜像大小优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-8-%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA"><span class="toc-text">1.3.8 多阶段构建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-text">总结：</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-1-Docker安装步骤"><a href="#1-1-Docker安装步骤" class="headerlink" title="1.1 Docker安装步骤"></a>1.1 Docker安装步骤</h2><pre><code class="docker">
</code></pre>
<h2 id="1-2-Docker基本命令"><a href="#1-2-Docker基本命令" class="headerlink" title="1.2 Docker基本命令"></a>1.2 Docker基本命令</h2><h3 id="1-2-1-查看-Dcoker-版本"><a href="#1-2-1-查看-Dcoker-版本" class="headerlink" title="1.2.1 查看 Dcoker 版本"></a>1.2.1 查看 Dcoker 版本</h3><p>查看 Dcoker 版本包括 Docker版本号、API 版本号、对应的 Git Commit、Containcrd 和 runC 的版本信息等。</p>
<pre><code class="bash">$ docker version
Client:
 Cloud integration: v1.0.33
 Version:           24.0.2
 API version:       1.43
 Go version:        go1.20.4
 Git commit:        cb74dfc
 Built:             Thu May 25 21:51:16 2023
 OS/Arch:           darwin/arm64
 Context:           desktop-linux

Server: Docker Desktop 4.20.1 (110738)
 Engine:
  Version:          24.0.2
  API version:      1.43 (minimum version 1.12)
  Go version:       go1.20.4
  Git commit:       659604f
  Built:            Thu May 25 21:50:59 2023
  OS/Arch:          linux/arm64
  Experimental:     false
 containerd:
  Version:          1.6.21
  GitCommit:        3dce8eb055cbb6872793272b4f20ed16117344f8
 runc:
  Version:          1.1.7
  GitCommit:        v1.1.7-0-g860f061
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
</code></pre>
<h3 id="1-2-2-查看-Dcoker-详细信息"><a href="#1-2-2-查看-Dcoker-详细信息" class="headerlink" title="1.2.2 查看 Dcoker 详细信息"></a>1.2.2 查看 Dcoker 详细信息</h3><pre><code class="shell">$ docker info
Client:       # Client端
 Version:    24.0.2
 Context:    desktop-linux
 Debug Mode: false      # 是否开启 Debug 模式
 Plugins:       # 个人环境中的插件
  buildx: Docker Buildx (Docker Inc.)
    Version:  v0.10.5
    Path:     /Users/bytedance/.docker/cli-plugins/docker-buildx
  compose: Docker Compose (Docker Inc.)
    Version:  v2.18.1
    Path:     /Users/bytedance/.docker/cli-plugins/docker-compose
  dev: Docker Dev Environments (Docker Inc.)
    Version:  v0.1.0
    Path:     /Users/bytedance/.docker/cli-plugins/docker-dev
  extension: Manages Docker extensions (Docker Inc.)
    Version:  v0.2.19
    Path:     /Users/bytedance/.docker/cli-plugins/docker-extension
  init: Creates Docker-related starter files for your project (Docker Inc.)
    Version:  v0.1.0-beta.4
    Path:     /Users/bytedance/.docker/cli-plugins/docker-init
  sbom: View the packaged-based Software Bill Of Materials (SBOM) for an image (Anchore Inc.)
    Version:  0.6.0
    Path:     /Users/bytedance/.docker/cli-plugins/docker-sbom
  scan: Docker Scan (Docker Inc.)
    Version:  v0.26.0
    Path:     /Users/bytedance/.docker/cli-plugins/docker-scan
  scout: Command line tool for Docker Scout (Docker Inc.)
    Version:  v0.12.0
    Path:     /Users/bytedance/.docker/cli-plugins/docker-scout

Server:         # Server端
 Containers: 0    # 容器个数
  Running: 0      # 正在运行的容器个数
  Paused: 0       # 暂停的容器个数
  Stopped: 0      # 停止的容器个数
 Images: 5        # 镜像个数
 Server Version: 24.0.2       # 当前服务器 Docker Server 的版本
 Storage Driver: overlay2     # 存储驱动，一般为 overlay2，性能好速度快
                              # 其他驱动 aufs、overlay、brtfs
  Backing Filesystem: extfs   # 服务器文件系统
  Supports d_type: true       # 目录条目类型，用来表示一个文件是文件、管道还是套接字。
                              # 在格式化 xfs 文件系统时，必须指定 ftype=1
  Using metacopy: false
  Native Overlay Diff: true
  userxattr: false
 Logging Driver: json-file    # 日志驱动，json-file 表示存在本地
 Cgroup Driver: cgroupfs      # 限制和隔离的驱动，生产环境建议使用 systemd
 Cgroup Version: 2
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog   # Docker支持的日志驱动
 Swarm: inactive      # Docker官方的容器编排工具，inactive不开启，active开启
 Runtimes: io.containerd.runc.v2 runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: 3dce8eb055cbb6872793272b4f20ed16117344f8
 runc version: v1.1.7-0-g860f061
 init version: de40ad0
 Security Options:
  seccomp
   Profile: builtin
  cgroupns
 Kernel Version: 5.15.49-linuxkit-pr
 Operating System: Docker Desktop
 OSType: linux
 Architecture: aarch64
 CPUs: 4
 Total Memory: 7.667GiB
 Name: docker-desktop
 ID: 3967aff3-ef2e-4400-8454-c25ef54214b6
 Docker Root Dir: /var/lib/docker     # Docker根目录，生产环境建议使用SSD硬盘，或者独立的磁盘，不要和系统盘用同一个磁盘。
 Debug Mode: false
 HTTP Proxy: http.docker.internal:3128
 HTTPS Proxy: http.docker.internal:3128
 No Proxy: hubproxy.docker.internal
 Experimental: false
 Insecure Registries:
  hubproxy.docker.internal:5555
  127.0.0.0/8
 Live Restore Enabled: false      # Docker热更新，生产环境建议设置为true
</code></pre>
<h3 id="1-2-3-搜索镜像"><a href="#1-2-3-搜索镜像" class="headerlink" title="1.2.3 搜索镜像"></a>1.2.3 搜索镜像</h3><pre><code class="shell">$ docker search nginx(镜像名称)
NAME                               DESCRIPTION                                      STARS     OFFICIAL   AUTOMATED
nginx                              Official build of Nginx.                         19549     [OK]
...
</code></pre>
<h3 id="1-2-4-拉取-下载镜像"><a href="#1-2-4-拉取-下载镜像" class="headerlink" title="1.2.4 拉取&#x2F;下载镜像"></a>1.2.4 拉取&#x2F;下载镜像</h3><pre><code class="shell">$ docker pull harbor.xxx.net/frontend:v1
拉取公网上的Nging镜像：
$ docker pull nginx（不指定版本号默认为latest）
$ docker pull nginx:1.21（指定版本号为1.21）
Using default tag: latest
latest: Pulling from library/nginx
a5573528b1f0: Pull complete 
8897d65c8417: Pull complete 
fbc138d1d206: Pull complete 
06f386eb9182: Pull complete 
aeb2f3db77c3: Pull complete 
64fb762834ec: Pull complete 
e5a7e61f6ff4: Pull complete 
Digest: sha256:4c0fdaa8b6341bfdeca5f18f7837462c80cff90527ee35ef185571e1c327beac
Status: Downloaded newer image for nginx:latest
docker.io/library/nginx:latest
</code></pre>
<h3 id="1-2-5-查看本地镜像"><a href="#1-2-5-查看本地镜像" class="headerlink" title="1.2.5 查看本地镜像"></a>1.2.5 查看本地镜像</h3><pre><code class="shell">$ docker images
REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
nginx        latest    6c7be49d2a11   3 months ago   192MB
</code></pre>
<h3 id="1-2-6-更改镜像-tag"><a href="#1-2-6-更改镜像-tag" class="headerlink" title="1.2.6 更改镜像 tag"></a>1.2.6 更改镜像 tag</h3><pre><code class="shell">$ docker tag nginx:latest nginx-v2:1.1
REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
nginx-v2     1.1       6c7be49d2a11   3 months ago   192MB
nginx        latest    6c7be49d2a11   3 months ago   192MB
$ docker rmi nginx-v2:1.1
</code></pre>
<h3 id="1-2-7-镜像仓库登陆"><a href="#1-2-7-镜像仓库登陆" class="headerlink" title="1.2.7 镜像仓库登陆"></a>1.2.7 镜像仓库登陆</h3><pre><code class="shell">$ docker login
$ docker logout
</code></pre>
<h3 id="1-2-8-推送本地镜像到远程仓库"><a href="#1-2-8-推送本地镜像到远程仓库" class="headerlink" title="1.2.8 推送本地镜像到远程仓库"></a>1.2.8 推送本地镜像到远程仓库</h3><pre><code class="shell">$ docker push 路径/镜像名称
</code></pre>
<h3 id="1-2-9-启动容器"><a href="#1-2-9-启动容器" class="headerlink" title="1.2.9 启动容器"></a>1.2.9 启动容器</h3><pre><code class="shell">使用 run -it 前台启动一个容器
$ docker run -it nginx bash（bash是启动时的shell）
root@8975c95675ad:/#
如果一个镜像需要一直运行，可以使用-d 进行后台启动:
$ docker run -itd nginx bash
ad53bd99822ba9ce116bf7a2d49a2428cbda6303cdb6af73b21d22749f245abf
也可以使用--restart=always，如果容器异常自动重启
$ docker ps
CONTAINER ID   IMAGE     COMMAND                   CREATED         STATUS         PORTS     NAMES
ad53bd99822b   nginx     &quot;/docker-entrypoint.…&quot;   8 seconds ago   Up 7 seconds   80/tcp    competent_sanderson
</code></pre>
<h3 id="1-2-10-端口映射"><a href="#1-2-10-端口映射" class="headerlink" title="1.2.10 端口映射"></a>1.2.10 端口映射</h3><pre><code class="shell">$ docker run -it -p 1234:80 nginx bash
$ docker run -itd -p 1234:80 nginx bash
</code></pre>
<h3 id="1-2-11-查看日志"><a href="#1-2-11-查看日志" class="headerlink" title="1.2.11 查看日志"></a>1.2.11 查看日志</h3><pre><code class="shell">$ docker logs -f 容器ID/容器名称 --tail 
172.17.0.1 - - [31/Jan/2024:06:14:35 +0000] &quot;GET / HTTP/1.1&quot; 304 0 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&quot; &quot;-&quot;
</code></pre>
<h3 id="1-2-12-查看容器详细信息"><a href="#1-2-12-查看容器详细信息" class="headerlink" title="1.2.12 查看容器详细信息"></a>1.2.12 查看容器详细信息</h3><pre><code class="shell">$ docker inspect 容器ID
[
    &#123;
        &quot;Id&quot;: &quot;ad53bd99822ba9ce116bf7a2d49a2428cbda6303cdb6af73b21d22749f245abf&quot;,
        &quot;Created&quot;: &quot;2024-01-30T07:24:17.87695363Z&quot;,
        &quot;Path&quot;: &quot;/docker-entrypoint.sh&quot;,
        &quot;Args&quot;: [
            &quot;bash&quot;
        ],
        &quot;State&quot;: &#123;
            &quot;Status&quot;: &quot;running&quot;,
            &quot;Running&quot;: true,
....
&quot;Gateway&quot;: &quot;172.17.0.1&quot;,
                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,
                    &quot;IPPrefixLen&quot;: 16,
                    &quot;IPv6Gateway&quot;: &quot;&quot;,
                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,
                    &quot;GlobalIPv6PrefixLen&quot;: 0,
                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,
                    &quot;DriverOpts&quot;: null
                &#125;
            &#125;
        &#125;
    &#125;
]
</code></pre>
<h3 id="1-2-13-查看当前运行的容器"><a href="#1-2-13-查看当前运行的容器" class="headerlink" title="1.2.13 查看当前运行的容器"></a>1.2.13 查看当前运行的容器</h3><pre><code class="shell">$ docker ps
CONTAINER ID   IMAGE     COMMAND                   CREATED        STATUS        PORTS                  NAMES
d6c106baa008   nginx     &quot;/docker-entrypoint.…&quot;   4 hours ago    Up 4 hours    0.0.0.0:1234-&gt;80/tcp   eloquent_carson
ad53bd99822b   nginx     &quot;/docker-entrypoint.…&quot;   23 hours ago   Up 23 hours   80/tcp                 competent_sanderson
</code></pre>
<p>查看所有容器，包括已经退出的容器。</p>
<pre><code class="shell">$ docker ps -a
...
</code></pre>
<p>查看正在运行的容器，只显示容器ID。</p>
<pre><code class="shell">$ docker ps -q
...
</code></pre>
<p>查看所有容器的ID，包括已经退出的容器ID。</p>
<pre><code class="shell">$ docker ps -aq
d6c106baa008
...
</code></pre>
<h3 id="1-2-14-删除已经退出的容器记录"><a href="#1-2-14-删除已经退出的容器记录" class="headerlink" title="1.2.14 删除已经退出的容器记录"></a>1.2.14 删除已经退出的容器记录</h3><pre><code class="shell">$ docker rm 容器ID
eba229c7c0ae
</code></pre>
<h3 id="1-2-15-进入到一个后台运行的容器"><a href="#1-2-15-进入到一个后台运行的容器" class="headerlink" title="1.2.15 进入到一个后台运行的容器"></a>1.2.15 进入到一个后台运行的容器</h3><pre><code class="shell">$ docker exec -it 容器ID bash
root@9e8cc59e0c97:/#
</code></pre>
<h3 id="1-2-16-停止-启动容器"><a href="#1-2-16-停止-启动容器" class="headerlink" title="1.2.16 停止&#x2F;启动容器"></a>1.2.16 停止&#x2F;启动容器</h3><pre><code class="shell">$ docker stop 容器ID
$ docker start 容器ID
</code></pre>
<h3 id="1-2-17-文件拷贝"><a href="#1-2-17-文件拷贝" class="headerlink" title="1.2.17 文件拷贝"></a>1.2.17 文件拷贝</h3><p>将本机的文件拷贝到容器，拷贝支持双向拷贝，也支持将容器的内部文件拷贝到宿主机。</p>
<pre><code class="shell">$ docker cp test/index.html 34a793d26866:/usr/share/nginx/html/
$ docker cp 34a793d26866:/usr/share/nginx/html/index.html .
</code></pre>
<h3 id="1-2-18-数据持久化"><a href="#1-2-18-数据持久化" class="headerlink" title="1.2.18 数据持久化"></a>1.2.18 数据持久化</h3><pre><code class="shell">$ docker run -itd -v /Users/bytedance/test:/usr/share/nginx/html -p 1234:80 nginx
f35aae1e06702312db253a3afd521759d17c42f7fb37a61a66a689549d8ad87a
$ mkdir test
$ echo &quot;这是一个测试文件。&quot; &gt; test/index.html
$ curl 0.0.0.0:1234
</code></pre>
<h2 id="1-3-DockerFile-的编写"><a href="#1-3-DockerFile-的编写" class="headerlink" title="1.3 DockerFile 的编写"></a>1.3 DockerFile 的编写</h2><h3 id="1-3-1-Dockerfile-的常用命令"><a href="#1-3-1-Dockerfile-的常用命令" class="headerlink" title="1.3.1 Dockerfile 的常用命令"></a>1.3.1 Dockerfile 的常用命令</h3><pre><code class="shell">FROM: 继承基础镜像
ENV: 配置环境变量
RUN: 用来执行shell命令
EXPOSE: 暴露端口号
WORKDIR: 设置容器的工作目录
CMD: 启动容器默认执行的命令，会被覆盖
ENTRYPOINT: 启动容器真正执行的命令，不会被覆盖
ADD: 复制文件到容器，一般拷贝文件，压缩包自动解压
COPY: 复制文件到容器，一般拷贝目录
USER: 容器使用的用户
MAINTAINER: 镜像制作作者的信息，已弃用，使用LABEL替代
LABEL: k=v形式，将一些元数据添加至镜像
ARG: 设置编译镜像时传入的参数
</code></pre>
<h3 id="1-3-2-构建镜像"><a href="#1-3-2-构建镜像" class="headerlink" title="1.3.2 构建镜像"></a>1.3.2 构建镜像</h3><p>使用 docker build 通过 Dockerfile 制作镜像。</p>
<pre><code class="shell">$ vim Dockerfile
FROM alpine 
RUN touch mjj
COPY Dockerfile .
$ docker build -t test:1.1 . 
test ： 镜像名称
1.1 ：镜像版本
. ：当前目录的Dockerfile文件，可以指定绝对路径
$ docker run -it test:1.1 ls
通过简单的dockerfile build，可以查看到镜像执行后的结果。
</code></pre>
<h3 id="1-3-3-CMD-和-ENTRYPOINT-的区别"><a href="#1-3-3-CMD-和-ENTRYPOINT-的区别" class="headerlink" title="1.3.3 CMD 和 ENTRYPOINT 的区别"></a>1.3.3 CMD 和 ENTRYPOINT 的区别</h3><pre><code class="shell"># 编写dockerfile文件
$ vim dockerfile-cmd
FROM centos:7
RUN mkdir test &amp;&amp; touch test/testfile
WORKDIR test/
CMD [&quot;ls&quot;,&quot;-l&quot;]
# 构建景象
$ docker build -f dockerfile-cmd -t docker:cmd .
# 运行镜像
$ docker run --rm docker:cmd 
total 0
-rw-r--r-- 1 root root 0 Feb 18 06:00 testfile
$ docker run --rm docker:cmd bash
# 在 docker run 后面加上其他参数后，CMD指定的参数就会被覆盖

# 修改dockerfile文件内容CMD为ENTRYPOINT后，直接运行
ENTRYPOINT [&quot;ls&quot;,&quot;-l&quot;]
$ docker run --rm docker:entrypoint
total 0
-rw-r--r-- 1 root root 0 Feb 18 06:00 testfile
$ docker run --rm docker:entrypoint -a
total 8
drwxr-xr-x 2 root root 4096 Feb 18 06:00 .
drwxr-xr-x 1 root root 4096 Feb 18 06:06 ..
-rw-r--r-- 1 root root    0 Feb 18 06:00 testfile
# 在 docker run 后面加上其他参数后，ENTRYPOINT指定的参数不会被覆盖
# ENTRYPOINT 指定--entrypoint 参数，比如指定 entrypoint 为 ls，后置命令为/tmp，就相当于 ENTRYPOINT 是 ls，CMD 是/tmp
$ docker run --rm --entrypoint docker:entrypoint /tmp
ks-script-us3cG8
yum.log
</code></pre>
<h3 id="1-3-4-COPY-和-ADD-的区别"><a href="#1-3-4-COPY-和-ADD-的区别" class="headerlink" title="1.3.4 COPY 和 ADD 的区别"></a>1.3.4 COPY 和 ADD 的区别</h3><pre><code class="shell"># 编写dockerfile文件
$ cat dockerfile-copy 
FROM centos:7
RUN mkdir test
WORKDIR test/
COPY dockerfile-cmd.tar.gz .
# 构建后并直接运行
$ docker run --rm docker:copy ls 
dockerfile-cmd.tar.gz
# 运行后是一个压缩的文件

# 修改dockerfile文件内容COPY为ADD后，直接运行
$ docker run --rm docker:copy ls 
dockerfile-cmd
# 运行后是一个解压后的文件
</code></pre>
<h3 id="1-3-5-定义作者信息"><a href="#1-3-5-定义作者信息" class="headerlink" title="1.3.5 定义作者信息"></a>1.3.5 定义作者信息</h3><pre><code class="shell">$ vim Dockerfile 
FROM centos:7
# MAINTAINER dot #即将废弃
LABEL maintainer=&quot;bot&quot; version=&quot;test&quot;
LABEL multiple=&quot;true&quot;
# 通过inspect查看作者信息
$ docker inspect docker:label | grep Label  -A 10 
&quot;Labels&quot;: &#123;
                &quot;maintainer&quot;: &quot;bot&quot;,
                &quot;multiple&quot;: &quot;true&quot;,
...
</code></pre>
<h3 id="1-3-6-Dockerfile-传参"><a href="#1-3-6-Dockerfile-传参" class="headerlink" title="1.3.6 Dockerfile 传参"></a>1.3.6 Dockerfile 传参</h3><p>使用 ARG 和 build-arg 传入动态变量：</p>
<pre><code class="shell">$ vim Dockerfile
FROM centos:7
# MAINTAINER dot #即将废弃
LABEL maintainer=&quot;bot&quot; version=&quot;test&quot;
LABEL multiple=&quot;true&quot;
ARG USERNAME
ARG DIR=&quot;defaultValue&quot;
RUN useradd -m $USERNAME -u 1001 &amp;&amp; mkdir $DIR
$ docker build --build-arg USERNAME=&quot;mjj&quot; -t docker:arg .
$ tail -1 /etc/passwd
mjj:x:1001:1001::/home/mjj:/bin/bash
</code></pre>
<h3 id="1-3-7-镜像大小优化"><a href="#1-3-7-镜像大小优化" class="headerlink" title="1.3.7 镜像大小优化"></a>1.3.7 镜像大小优化</h3><p>基础镜像体积较大时建议使用alpine进行构建。</p>
<pre><code class="shell"># 可以使用 docker history 看一下每个层的大小:
$ docker history 镜像ID
IMAGE          CREATED          CREATED BY                                       SIZE      COMMENT
56ddf721d406   13 minutes ago   COPY Dockerfile . # buildkit                     45B       buildkit.dockerfile.v0
&lt;missing&gt;      14 minutes ago   RUN /bin/sh -c touch mjj # buildkit              0B        buildkit.dockerfile.v0
&lt;missing&gt;      8 days ago       /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot;]               0B        
&lt;missing&gt;      8 days ago       /bin/sh -c #(nop) ADD file:d0764a717d1e9d0af…   7.73MB 
</code></pre>
<h3 id="1-3-8-多阶段构建"><a href="#1-3-8-多阶段构建" class="headerlink" title="1.3.8 多阶段构建"></a>1.3.8 多阶段构建</h3><p>创建一个 Go 语言 Hello World 程序：</p>
<pre><code class="shell">$ vim hello.go
package main
import &quot;fmt&quot;
func main() &#123;
   fmt.Println(&quot;Hello World!&quot;)
&#125;
</code></pre>
<p>单阶段构建：</p>
<pre><code class="shell">$ vim Dockerfile
FROM golang:1.14.4-alpine
LABEL maintainer=&quot;bot&quot; version=&quot;test&quot;
LABEL multiple=&quot;true&quot;
WORKDIR /opt
COPY hello.go /opt/
RUN go build /opt/hello.go
CMD [ &quot;./hello&quot; ]
# 执行构建测试并查看镜像大小
$ docker run -it --rm image:one 
Hello World!
$ docker images 
REPOSITORY   TAG       IMAGE ID       CREATED              SIZE
image        one       13ce4e84660d   About a minute ago   366MB
# 可以看到此时镜像大小为 366MB，但是上述的代码只需要构建步骤产生的二进制文件 hello 即可，这个文件大小可以进入到容器内部看一下:
$ ls -lh
total 2M     
-rwxr-xr-x    1 root     root        2.1M Feb 18 08:12 hello
</code></pre>
<p>多阶段构建：</p>
<pre><code class="shell">$ vim Dockerfile
# 编译步骤过程
FROM golang:1.14.4-alpine as builder
LABEL maintainer=&quot;bot&quot; version=&quot;test&quot;
LABEL multiple=&quot;true&quot;
WORKDIR /opt
COPY hello.go /opt/
RUN go build /opt/hello.go
# 生成应用镜像过程
FROM alpine:3.12
COPY --from=builder /opt/hello .
CMD [ &quot;./hello&quot; ]

# 再次构建后查看此时的镜像大小和运行镜像的效果:
$ docker build -t image:two .
$ docker run -it --rm image:two 
$ docker images
REPOSITORY   TAG       IMAGE ID       CREATED          SIZE
image        two       11f7c42e183e   2 minutes ago    7.49MB
image        one       13ce4e84660d   34 minutes ago   366MB
</code></pre>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><ol>
<li>相应命令需要多加练习。</li>
<li>容器每次启动，都会以最干净的状态进行启动。</li>
<li>笔记参考来源：<a target="_blank" rel="noopener" href="https://edu.51cto.com/lecturer/11062970.html">https://edu.51cto.com/lecturer/11062970.html</a></li>
</ol>

      
       
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©lover Panxiaoyu
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/mijunjie/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/mijunjie/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
